SELECT SUM("store_sales8307"."ss_net_profit") AS "total_sum", "store2897"."s_state", "store2897"."s_county", GROUPING("store2897"."s_state") + GROUPING("store2897"."s_county") AS "lochierarchy", RANK() OVER (PARTITION BY GROUPING("store2897"."s_state") + GROUPING("store2897"."s_county"), CASE WHEN GROUPING("store2897"."s_county") = 0 THEN "store2897"."s_state" ELSE NULL END ORDER BY SUM("store_sales8307"."ss_net_profit") DESC) AS "rank_within_parent" FROM "store_sales" AS "store_sales8307" CROSS JOIN "date_dim" AS "date_dim14713" CROSS JOIN "store" AS "store2897" INNER JOIN (SELECT "s_state" FROM (SELECT "store2898"."s_state", RANK() OVER (PARTITION BY "store2898"."s_state" ORDER BY SUM("store_sales8308"."ss_net_profit") DESC) AS "ranking" FROM "store_sales" AS "store_sales8308", "store" AS "store2898", "date_dim" AS "date_dim14714" WHERE "date_dim14714"."d_month_seq" >= 1220 AND "date_dim14714"."d_month_seq" <= 1220 + 11 AND "date_dim14714"."d_date_sk" = "store_sales8308"."ss_sold_date_sk" AND "store2898"."s_store_sk" = "store_sales8308"."ss_store_sk" GROUP BY "store2898"."s_state") AS "t105499" WHERE "t105499"."ranking" <= 5 GROUP BY "s_state") AS "t105502" ON "store2897"."s_state" = "t105502"."s_state" WHERE "date_dim14713"."d_month_seq" >= 1220 AND "date_dim14713"."d_month_seq" <= 1220 + 11 AND "date_dim14713"."d_date_sk" = "store_sales8307"."ss_sold_date_sk" AND "store2897"."s_store_sk" = "store_sales8307"."ss_store_sk" AND TRUE GROUP BY ROLLUP("store2897"."s_state", "store2897"."s_county") ORDER BY GROUPING("store2897"."s_state") + GROUPING("store2897"."s_county") DESC, CASE WHEN GROUPING("store2897"."s_state") + GROUPING("store2897"."s_county") = 0 THEN "store2897"."s_state" ELSE NULL END, RANK() OVER (PARTITION BY GROUPING("store2897"."s_state") + GROUPING("store2897"."s_county"), CASE WHEN GROUPING("store2897"."s_county") = 0 THEN "store2897"."s_state" ELSE NULL END ORDER BY SUM("store_sales8307"."ss_net_profit") DESC) FETCH NEXT 100 ROWS ONLY