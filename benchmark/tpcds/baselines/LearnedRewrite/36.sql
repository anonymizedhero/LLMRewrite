SELECT SUM("store_sales4683"."ss_net_profit") / SUM("store_sales4683"."ss_ext_sales_price") AS "gross_margin", "item2307"."i_category", "item2307"."i_class", GROUPING("item2307"."i_category") + GROUPING("item2307"."i_class") AS "lochierarchy", RANK() OVER (PARTITION BY GROUPING("item2307"."i_category") + GROUPING("item2307"."i_class"), CASE WHEN GROUPING("item2307"."i_class") = 0 THEN "item2307"."i_category" ELSE NULL END ORDER BY SUM("store_sales4683"."ss_net_profit") / SUM("store_sales4683"."ss_ext_sales_price")) AS "rank_within_parent" FROM "store_sales" AS "store_sales4683" INNER JOIN (SELECT * FROM "date_dim" WHERE "d_year" = 2000) AS "t49686" ON "store_sales4683"."ss_sold_date_sk" = "t49686"."d_date_sk" INNER JOIN "item" AS "item2307" ON "store_sales4683"."ss_item_sk" = "item2307"."i_item_sk" INNER JOIN (SELECT * FROM "store" WHERE "s_state" = 'TN') AS "t49687" ON "store_sales4683"."ss_store_sk" = "t49687"."s_store_sk" GROUP BY ROLLUP("item2307"."i_class", "item2307"."i_category") ORDER BY GROUPING("item2307"."i_category") + GROUPING("item2307"."i_class") DESC, CASE WHEN GROUPING("item2307"."i_category") + GROUPING("item2307"."i_class") = 0 THEN "item2307"."i_category" ELSE NULL END, RANK() OVER (PARTITION BY GROUPING("item2307"."i_category") + GROUPING("item2307"."i_class"), CASE WHEN GROUPING("item2307"."i_class") = 0 THEN "item2307"."i_category" ELSE NULL END ORDER BY SUM("store_sales4683"."ss_net_profit") / SUM("store_sales4683"."ss_ext_sales_price")) FETCH NEXT 100 ROWS ONLY