SELECT "s_store_name", "s_company_name", "d_year", "avg_monthly_sales", "sum_sales", "psum", "nsum" FROM (SELECT "t61174"."s_store_name", "t61174"."s_company_name", "t61174"."d_year", "t61174"."avg_monthly_sales", "t61174"."sum_sales", "t61178"."sum_sales" AS "psum", "t61182"."sum_sales" AS "nsum" FROM (SELECT "item3317"."i_category", "item3317"."i_brand", "store1105"."s_store_name", "store1105"."s_company_name", "date_dim8572"."d_year", "date_dim8572"."d_moy", SUM("store_sales5507"."ss_sales_price") AS "sum_sales", (SUM(SUM("store_sales5507"."ss_sales_price")) OVER (PARTITION BY "item3317"."i_category", "item3317"."i_brand", "store1105"."s_store_name", "store1105"."s_company_name", "date_dim8572"."d_year" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)) / (COUNT(SUM("store_sales5507"."ss_sales_price")) OVER (PARTITION BY "item3317"."i_category", "item3317"."i_brand", "store1105"."s_store_name", "store1105"."s_company_name", "date_dim8572"."d_year" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)) AS "avg_monthly_sales", RANK() OVER (PARTITION BY "item3317"."i_category", "item3317"."i_brand", "store1105"."s_store_name", "store1105"."s_company_name" ORDER BY "date_dim8572"."d_year", "date_dim8572"."d_moy") AS "rn" FROM "item" AS "item3317", "store_sales" AS "store_sales5507", "date_dim" AS "date_dim8572", "store" AS "store1105" WHERE "store_sales5507"."ss_item_sk" = "item3317"."i_item_sk" AND "store_sales5507"."ss_sold_date_sk" = "date_dim8572"."d_date_sk" AND "store_sales5507"."ss_store_sk" = "store1105"."s_store_sk" AND ("date_dim8572"."d_year" = 2000 OR "date_dim8572"."d_year" = 2000 - 1 AND "date_dim8572"."d_moy" = 12 OR "date_dim8572"."d_year" = 2000 + 1 AND "date_dim8572"."d_moy" = 1) GROUP BY "item3317"."i_category", "item3317"."i_brand", "store1105"."s_store_name", "store1105"."s_company_name", "date_dim8572"."d_year", "date_dim8572"."d_moy") AS "t61174", (SELECT "item3318"."i_category", "item3318"."i_brand", "store1106"."s_store_name", "store1106"."s_company_name", "date_dim8573"."d_year", "date_dim8573"."d_moy", SUM("store_sales5508"."ss_sales_price") AS "sum_sales", (SUM(SUM("store_sales5508"."ss_sales_price")) OVER (PARTITION BY "item3318"."i_category", "item3318"."i_brand", "store1106"."s_store_name", "store1106"."s_company_name", "date_dim8573"."d_year" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)) / (COUNT(SUM("store_sales5508"."ss_sales_price")) OVER (PARTITION BY "item3318"."i_category", "item3318"."i_brand", "store1106"."s_store_name", "store1106"."s_company_name", "date_dim8573"."d_year" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)) AS "avg_monthly_sales", RANK() OVER (PARTITION BY "item3318"."i_category", "item3318"."i_brand", "store1106"."s_store_name", "store1106"."s_company_name" ORDER BY "date_dim8573"."d_year", "date_dim8573"."d_moy") AS "rn" FROM "item" AS "item3318", "store_sales" AS "store_sales5508", "date_dim" AS "date_dim8573", "store" AS "store1106" WHERE "store_sales5508"."ss_item_sk" = "item3318"."i_item_sk" AND "store_sales5508"."ss_sold_date_sk" = "date_dim8573"."d_date_sk" AND "store_sales5508"."ss_store_sk" = "store1106"."s_store_sk" AND ("date_dim8573"."d_year" = 2000 OR "date_dim8573"."d_year" = 2000 - 1 AND "date_dim8573"."d_moy" = 12 OR "date_dim8573"."d_year" = 2000 + 1 AND "date_dim8573"."d_moy" = 1) GROUP BY "item3318"."i_category", "item3318"."i_brand", "store1106"."s_store_name", "store1106"."s_company_name", "date_dim8573"."d_year", "date_dim8573"."d_moy") AS "t61178", (SELECT "item3319"."i_category", "item3319"."i_brand", "store1107"."s_store_name", "store1107"."s_company_name", "date_dim8574"."d_year", "date_dim8574"."d_moy", SUM("store_sales5509"."ss_sales_price") AS "sum_sales", (SUM(SUM("store_sales5509"."ss_sales_price")) OVER (PARTITION BY "item3319"."i_category", "item3319"."i_brand", "store1107"."s_store_name", "store1107"."s_company_name", "date_dim8574"."d_year" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)) / (COUNT(SUM("store_sales5509"."ss_sales_price")) OVER (PARTITION BY "item3319"."i_category", "item3319"."i_brand", "store1107"."s_store_name", "store1107"."s_company_name", "date_dim8574"."d_year" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)) AS "avg_monthly_sales", RANK() OVER (PARTITION BY "item3319"."i_category", "item3319"."i_brand", "store1107"."s_store_name", "store1107"."s_company_name" ORDER BY "date_dim8574"."d_year", "date_dim8574"."d_moy") AS "rn" FROM "item" AS "item3319", "store_sales" AS "store_sales5509", "date_dim" AS "date_dim8574", "store" AS "store1107" WHERE "store_sales5509"."ss_item_sk" = "item3319"."i_item_sk" AND "store_sales5509"."ss_sold_date_sk" = "date_dim8574"."d_date_sk" AND "store_sales5509"."ss_store_sk" = "store1107"."s_store_sk" AND ("date_dim8574"."d_year" = 2000 OR "date_dim8574"."d_year" = 2000 - 1 AND "date_dim8574"."d_moy" = 12 OR "date_dim8574"."d_year" = 2000 + 1 AND "date_dim8574"."d_moy" = 1) GROUP BY "item3319"."i_category", "item3319"."i_brand", "store1107"."s_store_name", "store1107"."s_company_name", "date_dim8574"."d_year", "date_dim8574"."d_moy") AS "t61182" WHERE "t61174"."i_category" = "t61178"."i_category" AND "t61174"."i_category" = "t61182"."i_category" AND ("t61174"."i_brand" = "t61178"."i_brand" AND ("t61174"."i_brand" = "t61182"."i_brand" AND "t61174"."s_store_name" = "t61178"."s_store_name")) AND ("t61174"."s_store_name" = "t61182"."s_store_name" AND "t61174"."s_company_name" = "t61178"."s_company_name" AND ("t61174"."s_company_name" = "t61182"."s_company_name" AND ("t61174"."rn" = "t61178"."rn" + 1 AND "t61174"."rn" = "t61182"."rn" - 1)))) AS "t61184" WHERE "t61184"."d_year" = 2000 AND "t61184"."avg_monthly_sales" > 0 AND CASE WHEN "t61184"."avg_monthly_sales" > 0 THEN CAST(ABS("t61184"."sum_sales" - "t61184"."avg_monthly_sales") / "t61184"."avg_monthly_sales" AS DECIMAL(19, 0)) ELSE NULL END > 0.1 ORDER BY "sum_sales" - "avg_monthly_sales", "nsum" FETCH NEXT 100 ROWS ONLY