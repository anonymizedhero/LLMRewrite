SELECT "t112376"."ss_customer_sk", ROUND("t112376"."ss_qty" / (CASE WHEN "t112382"."ws_qty" IS NOT NULL THEN CAST("t112382"."ws_qty" AS INTEGER) ELSE 0 END + CASE WHEN "t112388"."cs_qty" IS NOT NULL THEN CAST("t112388"."cs_qty" AS INTEGER) ELSE 0 END), 2) AS "ratio", "t112376"."ss_qty" AS "store_qty", "t112376"."ss_wc" AS "store_wholesale_cost", "t112376"."ss_sp" AS "store_sales_price", CASE WHEN "t112382"."ws_qty" IS NOT NULL THEN CAST("t112382"."ws_qty" AS INTEGER) ELSE 0 END + CASE WHEN "t112388"."cs_qty" IS NOT NULL THEN CAST("t112388"."cs_qty" AS INTEGER) ELSE 0 END AS "other_chan_qty", CASE WHEN "t112382"."ws_wc" IS NOT NULL THEN CAST("t112382"."ws_wc" AS DECIMAL(19, 0)) ELSE 0 END + CASE WHEN "t112388"."cs_wc" IS NOT NULL THEN CAST("t112388"."cs_wc" AS DECIMAL(19, 0)) ELSE 0 END AS "other_chan_wholesale_cost", CASE WHEN "t112382"."ws_sp" IS NOT NULL THEN CAST("t112382"."ws_sp" AS DECIMAL(19, 0)) ELSE 0 END + CASE WHEN "t112388"."cs_sp" IS NOT NULL THEN CAST("t112388"."cs_sp" AS DECIMAL(19, 0)) ELSE 0 END AS "other_chan_sales_price" FROM (SELECT 1998 AS "d_year", "t112371"."ss_item_sk", "t112371"."ss_customer_sk", SUM(CAST("t112371"."ss_qty" * "t112373"."f1" AS INTEGER)) AS "ss_qty", SUM("t112371"."ss_wc" * "t112373"."f1") AS "ss_wc", SUM("t112371"."ss_sp" * "t112373"."f1") AS "ss_sp" FROM (SELECT "store_sales8683"."ss_sold_date_sk", "store_sales8683"."ss_item_sk", "store_sales8683"."ss_customer_sk", SUM("store_sales8683"."ss_quantity") AS "ss_qty", SUM("store_sales8683"."ss_wholesale_cost") AS "ss_wc", SUM("store_sales8683"."ss_sales_price") AS "ss_sp" FROM "store_sales" AS "store_sales8683" LEFT JOIN "store_returns" AS "store_returns989" ON "store_sales8683"."ss_ticket_number" = "store_returns989"."sr_ticket_number" AND "store_sales8683"."ss_item_sk" = "store_returns989"."sr_item_sk" WHERE "store_returns989"."sr_ticket_number" IS NULL GROUP BY "store_sales8683"."ss_sold_date_sk", "store_sales8683"."ss_item_sk", "store_sales8683"."ss_customer_sk") AS "t112371" INNER JOIN (SELECT "d_date_sk", COUNT(*) AS "f1" FROM "date_dim" WHERE "d_year" = 1998 GROUP BY "d_date_sk") AS "t112373" ON "t112371"."ss_sold_date_sk" = "t112373"."d_date_sk" GROUP BY "t112371"."ss_item_sk", "t112371"."ss_customer_sk") AS "t112376" LEFT JOIN (SELECT "t112379"."d_year", "t112378"."ws_item_sk", "t112378"."ws_bill_customer_sk", SUM(CAST("t112378"."ws_qty" * "t112379"."f2" AS INTEGER)) AS "ws_qty", SUM("t112378"."ws_wc" * "t112379"."f2") AS "ws_wc", SUM("t112378"."ws_sp" * "t112379"."f2") AS "ws_sp" FROM (SELECT "web_sales3166"."ws_sold_date_sk", "web_sales3166"."ws_item_sk", "web_sales3166"."ws_bill_customer_sk", SUM("web_sales3166"."ws_quantity") AS "ws_qty", SUM("web_sales3166"."ws_wholesale_cost") AS "ws_wc", SUM("web_sales3166"."ws_sales_price") AS "ws_sp" FROM "web_sales" AS "web_sales3166" LEFT JOIN "web_returns" AS "web_returns359" ON "web_sales3166"."ws_order_number" = "web_returns359"."wr_order_number" AND "web_sales3166"."ws_item_sk" = "web_returns359"."wr_item_sk" WHERE "web_returns359"."wr_order_number" IS NULL GROUP BY "web_sales3166"."ws_sold_date_sk", "web_sales3166"."ws_item_sk", "web_sales3166"."ws_bill_customer_sk") AS "t112378" INNER JOIN (SELECT "d_date_sk", "d_year", COUNT(*) AS "f2" FROM "date_dim" GROUP BY "d_date_sk", "d_year") AS "t112379" ON "t112378"."ws_sold_date_sk" = "t112379"."d_date_sk" GROUP BY "t112378"."ws_item_sk", "t112378"."ws_bill_customer_sk", "t112379"."d_year") AS "t112382" ON "t112376"."d_year" = "t112382"."d_year" AND "t112376"."ss_item_sk" = "t112382"."ws_item_sk" AND "t112376"."ss_customer_sk" = "t112382"."ws_bill_customer_sk" LEFT JOIN (SELECT "t112385"."d_year", "t112384"."cs_item_sk", "t112384"."cs_bill_customer_sk", SUM(CAST("t112384"."cs_qty" * "t112385"."f2" AS INTEGER)) AS "cs_qty", SUM("t112384"."cs_wc" * "t112385"."f2") AS "cs_wc", SUM("t112384"."cs_sp" * "t112385"."f2") AS "cs_sp" FROM (SELECT "catalog_sales3394"."cs_sold_date_sk", "catalog_sales3394"."cs_bill_customer_sk", "catalog_sales3394"."cs_item_sk", SUM("catalog_sales3394"."cs_quantity") AS "cs_qty", SUM("catalog_sales3394"."cs_wholesale_cost") AS "cs_wc", SUM("catalog_sales3394"."cs_sales_price") AS "cs_sp" FROM "catalog_sales" AS "catalog_sales3394" LEFT JOIN "catalog_returns" AS "catalog_returns569" ON "catalog_sales3394"."cs_order_number" = "catalog_returns569"."cr_order_number" AND "catalog_sales3394"."cs_item_sk" = "catalog_returns569"."cr_item_sk" WHERE "catalog_returns569"."cr_order_number" IS NULL GROUP BY "catalog_sales3394"."cs_sold_date_sk", "catalog_sales3394"."cs_bill_customer_sk", "catalog_sales3394"."cs_item_sk") AS "t112384" INNER JOIN (SELECT "d_date_sk", "d_year", COUNT(*) AS "f2" FROM "date_dim" GROUP BY "d_date_sk", "d_year") AS "t112385" ON "t112384"."cs_sold_date_sk" = "t112385"."d_date_sk" GROUP BY "t112384"."cs_bill_customer_sk", "t112384"."cs_item_sk", "t112385"."d_year") AS "t112388" ON "t112376"."d_year" = "t112388"."d_year" AND "t112376"."ss_item_sk" = "t112388"."cs_item_sk" AND "t112376"."ss_customer_sk" = "t112388"."cs_bill_customer_sk" WHERE CASE WHEN "t112382"."ws_qty" IS NOT NULL THEN CAST("t112382"."ws_qty" AS INTEGER) > 0 ELSE FALSE END OR CASE WHEN "t112388"."cs_qty" IS NOT NULL THEN CAST("t112388"."cs_qty" AS INTEGER) > 0 ELSE FALSE END ORDER BY "t112376"."ss_customer_sk", "t112376"."ss_qty" DESC, "t112376"."ss_wc" DESC, "t112376"."ss_sp" DESC, CASE WHEN "t112382"."ws_qty" IS NOT NULL THEN CAST("t112382"."ws_qty" AS INTEGER) ELSE 0 END + CASE WHEN "t112388"."cs_qty" IS NOT NULL THEN CAST("t112388"."cs_qty" AS INTEGER) ELSE 0 END, CASE WHEN "t112382"."ws_wc" IS NOT NULL THEN CAST("t112382"."ws_wc" AS DECIMAL(19, 0)) ELSE 0 END + CASE WHEN "t112388"."cs_wc" IS NOT NULL THEN CAST("t112388"."cs_wc" AS DECIMAL(19, 0)) ELSE 0 END, CASE WHEN "t112382"."ws_sp" IS NOT NULL THEN CAST("t112382"."ws_sp" AS DECIMAL(19, 0)) ELSE 0 END + CASE WHEN "t112388"."cs_sp" IS NOT NULL THEN CAST("t112388"."cs_sp" AS DECIMAL(19, 0)) ELSE 0 END, ROUND("t112376"."ss_qty" / (CASE WHEN "t112382"."ws_qty" IS NOT NULL THEN CAST("t112382"."ws_qty" AS INTEGER) ELSE 0 END + CASE WHEN "t112388"."cs_qty" IS NOT NULL THEN CAST("t112388"."cs_qty" AS INTEGER) ELSE 0 END), 2) FETCH NEXT 100 ROWS ONLY