SELECT "customer4227"."c_last_name", "customer4227"."c_first_name", "customer4227"."c_salutation", "customer4227"."c_preferred_cust_flag", "t109202"."ss_ticket_number", "t109202"."cnt" FROM (SELECT * FROM (SELECT "t109195"."ss_ticket_number", "t109195"."ss_customer_sk", COALESCE(SUM("t109195"."cnt" * "t109197"."cnt"), 0) AS "cnt" FROM (SELECT "t109190"."ss_customer_sk", "t109190"."ss_hdemo_sk", "t109190"."ss_ticket_number", COALESCE(SUM("t109190"."cnt" * "t109192"."cnt"), 0) AS "cnt" FROM (SELECT "t109185"."ss_customer_sk", "t109185"."ss_hdemo_sk", "t109185"."ss_store_sk", "t109185"."ss_ticket_number", COALESCE(SUM("t109185"."cnt" * "t109187"."cnt"), 0) AS "cnt" FROM (SELECT "ss_sold_date_sk", "ss_customer_sk", "ss_hdemo_sk", "ss_store_sk", "ss_ticket_number", COUNT(*) AS "cnt" FROM "store_sales" GROUP BY "ss_sold_date_sk", "ss_customer_sk", "ss_hdemo_sk", "ss_store_sk", "ss_ticket_number") AS "t109185", (SELECT "d_date_sk", COUNT(*) AS "cnt" FROM "date_dim" WHERE "d_dom" >= 1 AND "d_dom" <= 2 AND ("d_year" = 2000 OR "d_year" = 2000 + 1 OR "d_year" = 2000 + 2) GROUP BY "d_date_sk") AS "t109187" WHERE "t109185"."ss_sold_date_sk" = "t109187"."d_date_sk" GROUP BY "t109185"."ss_customer_sk", "t109185"."ss_hdemo_sk", "t109185"."ss_store_sk", "t109185"."ss_ticket_number") AS "t109190", (SELECT "s_store_sk", COUNT(*) AS "cnt" FROM "store" WHERE "s_county" = 'Williamson County' GROUP BY "s_store_sk") AS "t109192" WHERE "t109190"."ss_store_sk" = "t109192"."s_store_sk" GROUP BY "t109190"."ss_customer_sk", "t109190"."ss_hdemo_sk", "t109190"."ss_ticket_number") AS "t109195", (SELECT "hd_demo_sk", COUNT(*) AS "cnt" FROM "household_demographics" WHERE "hd_buy_potential" IN ('1001-5000', '5001-10000') AND "hd_vehicle_count" > 0 AND CASE WHEN "hd_vehicle_count" > 0 THEN "hd_dep_count" / "hd_vehicle_count" > 1 ELSE FALSE END GROUP BY "hd_demo_sk") AS "t109197" WHERE "t109195"."ss_hdemo_sk" = "t109197"."hd_demo_sk" GROUP BY "t109195"."ss_customer_sk", "t109195"."ss_ticket_number") AS "t109201" WHERE "t109201"."cnt" >= 1 AND "t109201"."cnt" <= 5) AS "t109202", "customer" AS "customer4227" WHERE "t109202"."ss_customer_sk" = "customer4227"."c_customer_sk" ORDER BY "t109202"."cnt" DESC, "customer4227"."c_last_name"