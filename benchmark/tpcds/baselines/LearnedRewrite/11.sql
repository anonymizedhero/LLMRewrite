SELECT "t11631"."customer_id", "t11631"."customer_first_name", "t11631"."customer_last_name", "t11631"."customer_email_address" FROM (SELECT "customer398"."c_customer_id" AS "customer_id", "customer398"."c_first_name" AS "customer_first_name", "customer398"."c_last_name" AS "customer_last_name", "customer398"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer398"."c_birth_country" AS "customer_birth_country", "customer398"."c_login" AS "customer_login", "customer398"."c_email_address" AS "customer_email_address", "date_dim1566"."d_year" AS "dyear", SUM("store_sales1713"."ss_ext_list_price" - "store_sales1713"."ss_ext_discount_amt") AS "year_total", 's' AS "sale_type" FROM "customer" AS "customer398", "store_sales" AS "store_sales1713", "date_dim" AS "date_dim1566" WHERE "customer398"."c_customer_sk" = "store_sales1713"."ss_customer_sk" AND "store_sales1713"."ss_sold_date_sk" = "date_dim1566"."d_date_sk" GROUP BY "customer398"."c_customer_id", "customer398"."c_first_name", "customer398"."c_last_name", "customer398"."c_preferred_cust_flag", "customer398"."c_birth_country", "customer398"."c_login", "customer398"."c_email_address", "date_dim1566"."d_year" UNION ALL SELECT "customer399"."c_customer_id" AS "customer_id", "customer399"."c_first_name" AS "customer_first_name", "customer399"."c_last_name" AS "customer_last_name", "customer399"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer399"."c_birth_country" AS "customer_birth_country", "customer399"."c_login" AS "customer_login", "customer399"."c_email_address" AS "customer_email_address", "date_dim1567"."d_year" AS "dyear", SUM("web_sales398"."ws_ext_list_price" - "web_sales398"."ws_ext_discount_amt") AS "year_total", 'w' AS "sale_type" FROM "customer" AS "customer399", "web_sales" AS "web_sales398", "date_dim" AS "date_dim1567" WHERE "customer399"."c_customer_sk" = "web_sales398"."ws_bill_customer_sk" AND "web_sales398"."ws_sold_date_sk" = "date_dim1567"."d_date_sk" GROUP BY "customer399"."c_customer_id", "customer399"."c_first_name", "customer399"."c_last_name", "customer399"."c_preferred_cust_flag", "customer399"."c_birth_country", "customer399"."c_login", "customer399"."c_email_address", "date_dim1567"."d_year") AS "t11622", (SELECT "customer400"."c_customer_id" AS "customer_id", "customer400"."c_first_name" AS "customer_first_name", "customer400"."c_last_name" AS "customer_last_name", "customer400"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer400"."c_birth_country" AS "customer_birth_country", "customer400"."c_login" AS "customer_login", "customer400"."c_email_address" AS "customer_email_address", "date_dim1568"."d_year" AS "dyear", SUM("store_sales1714"."ss_ext_list_price" - "store_sales1714"."ss_ext_discount_amt") AS "year_total", 's' AS "sale_type" FROM "customer" AS "customer400", "store_sales" AS "store_sales1714", "date_dim" AS "date_dim1568" WHERE "customer400"."c_customer_sk" = "store_sales1714"."ss_customer_sk" AND "store_sales1714"."ss_sold_date_sk" = "date_dim1568"."d_date_sk" GROUP BY "customer400"."c_customer_id", "customer400"."c_first_name", "customer400"."c_last_name", "customer400"."c_preferred_cust_flag", "customer400"."c_birth_country", "customer400"."c_login", "customer400"."c_email_address", "date_dim1568"."d_year" UNION ALL SELECT "customer401"."c_customer_id" AS "customer_id", "customer401"."c_first_name" AS "customer_first_name", "customer401"."c_last_name" AS "customer_last_name", "customer401"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer401"."c_birth_country" AS "customer_birth_country", "customer401"."c_login" AS "customer_login", "customer401"."c_email_address" AS "customer_email_address", "date_dim1569"."d_year" AS "dyear", SUM("web_sales399"."ws_ext_list_price" - "web_sales399"."ws_ext_discount_amt") AS "year_total", 'w' AS "sale_type" FROM "customer" AS "customer401", "web_sales" AS "web_sales399", "date_dim" AS "date_dim1569" WHERE "customer401"."c_customer_sk" = "web_sales399"."ws_bill_customer_sk" AND "web_sales399"."ws_sold_date_sk" = "date_dim1569"."d_date_sk" GROUP BY "customer401"."c_customer_id", "customer401"."c_first_name", "customer401"."c_last_name", "customer401"."c_preferred_cust_flag", "customer401"."c_birth_country", "customer401"."c_login", "customer401"."c_email_address", "date_dim1569"."d_year") AS "t11631", (SELECT "customer402"."c_customer_id" AS "customer_id", "customer402"."c_first_name" AS "customer_first_name", "customer402"."c_last_name" AS "customer_last_name", "customer402"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer402"."c_birth_country" AS "customer_birth_country", "customer402"."c_login" AS "customer_login", "customer402"."c_email_address" AS "customer_email_address", "date_dim1570"."d_year" AS "dyear", SUM("store_sales1715"."ss_ext_list_price" - "store_sales1715"."ss_ext_discount_amt") AS "year_total", 's' AS "sale_type" FROM "customer" AS "customer402", "store_sales" AS "store_sales1715", "date_dim" AS "date_dim1570" WHERE "customer402"."c_customer_sk" = "store_sales1715"."ss_customer_sk" AND "store_sales1715"."ss_sold_date_sk" = "date_dim1570"."d_date_sk" GROUP BY "customer402"."c_customer_id", "customer402"."c_first_name", "customer402"."c_last_name", "customer402"."c_preferred_cust_flag", "customer402"."c_birth_country", "customer402"."c_login", "customer402"."c_email_address", "date_dim1570"."d_year" UNION ALL SELECT "customer403"."c_customer_id" AS "customer_id", "customer403"."c_first_name" AS "customer_first_name", "customer403"."c_last_name" AS "customer_last_name", "customer403"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer403"."c_birth_country" AS "customer_birth_country", "customer403"."c_login" AS "customer_login", "customer403"."c_email_address" AS "customer_email_address", "date_dim1571"."d_year" AS "dyear", SUM("web_sales400"."ws_ext_list_price" - "web_sales400"."ws_ext_discount_amt") AS "year_total", 'w' AS "sale_type" FROM "customer" AS "customer403", "web_sales" AS "web_sales400", "date_dim" AS "date_dim1571" WHERE "customer403"."c_customer_sk" = "web_sales400"."ws_bill_customer_sk" AND "web_sales400"."ws_sold_date_sk" = "date_dim1571"."d_date_sk" GROUP BY "customer403"."c_customer_id", "customer403"."c_first_name", "customer403"."c_last_name", "customer403"."c_preferred_cust_flag", "customer403"."c_birth_country", "customer403"."c_login", "customer403"."c_email_address", "date_dim1571"."d_year") AS "t11640", (SELECT "customer404"."c_customer_id" AS "customer_id", "customer404"."c_first_name" AS "customer_first_name", "customer404"."c_last_name" AS "customer_last_name", "customer404"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer404"."c_birth_country" AS "customer_birth_country", "customer404"."c_login" AS "customer_login", "customer404"."c_email_address" AS "customer_email_address", "date_dim1572"."d_year" AS "dyear", SUM("store_sales1716"."ss_ext_list_price" - "store_sales1716"."ss_ext_discount_amt") AS "year_total", 's' AS "sale_type" FROM "customer" AS "customer404", "store_sales" AS "store_sales1716", "date_dim" AS "date_dim1572" WHERE "customer404"."c_customer_sk" = "store_sales1716"."ss_customer_sk" AND "store_sales1716"."ss_sold_date_sk" = "date_dim1572"."d_date_sk" GROUP BY "customer404"."c_customer_id", "customer404"."c_first_name", "customer404"."c_last_name", "customer404"."c_preferred_cust_flag", "customer404"."c_birth_country", "customer404"."c_login", "customer404"."c_email_address", "date_dim1572"."d_year" UNION ALL SELECT "customer405"."c_customer_id" AS "customer_id", "customer405"."c_first_name" AS "customer_first_name", "customer405"."c_last_name" AS "customer_last_name", "customer405"."c_preferred_cust_flag" AS "customer_preferred_cust_flag", "customer405"."c_birth_country" AS "customer_birth_country", "customer405"."c_login" AS "customer_login", "customer405"."c_email_address" AS "customer_email_address", "date_dim1573"."d_year" AS "dyear", SUM("web_sales401"."ws_ext_list_price" - "web_sales401"."ws_ext_discount_amt") AS "year_total", 'w' AS "sale_type" FROM "customer" AS "customer405", "web_sales" AS "web_sales401", "date_dim" AS "date_dim1573" WHERE "customer405"."c_customer_sk" = "web_sales401"."ws_bill_customer_sk" AND "web_sales401"."ws_sold_date_sk" = "date_dim1573"."d_date_sk" GROUP BY "customer405"."c_customer_id", "customer405"."c_first_name", "customer405"."c_last_name", "customer405"."c_preferred_cust_flag", "customer405"."c_birth_country", "customer405"."c_login", "customer405"."c_email_address", "date_dim1573"."d_year") AS "t11649" WHERE "t11631"."customer_id" = "t11622"."customer_id" AND ("t11622"."customer_id" = "t11649"."customer_id" AND "t11622"."customer_id" = "t11640"."customer_id") AND ("t11622"."sale_type" = 's' AND "t11640"."sale_type" = 'w' AND ("t11631"."sale_type" = 's' AND "t11649"."sale_type" = 'w')) AND ("t11622"."dyear" = 1998 AND ("t11631"."dyear" = 1998 + 1 AND "t11640"."dyear" = 1998) AND ("t11649"."dyear" = 1998 + 1 AND "t11622"."year_total" > 0 AND ("t11640"."year_total" > 0 AND CASE WHEN "t11640"."year_total" > 0 THEN "t11649"."year_total" / "t11640"."year_total" ELSE 0.0 END > CASE WHEN "t11622"."year_total" > 0 THEN "t11631"."year_total" / "t11622"."year_total" ELSE 0.0 END))) ORDER BY "t11631"."customer_id", "t11631"."customer_first_name", "t11631"."customer_last_name", "t11631"."customer_email_address" FETCH NEXT 100 ROWS ONLY